apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: bookreview-ssm
  namespace: bookreview
spec:
  provider: aws
  parameters:
    objects: |
      - objectName: "/${var.project}-${var.environment}/db/username"
        objectType: "ssmparameter"
        objectAlias: DB_USERNAME
      - objectName: "/${var.project}-${var.environment}/db/password"
        objectType: "ssmparameter"
        objectAlias: DB_PASSWORD
      - objectName: "/${var.project}-${var.environment}/db/endpoint"
        objectType: "ssmparameter"
        objectAlias: DB_ENDPOINT
      - objectName: "/${var.project}-${var.environment}/db/name"
        objectType: "ssmparameter"
        objectAlias: DB_NAME
  secretObjects:
    - secretName: bookreview-db-ssm
      type: Opaque
      data:
        - key: DB_USERNAME
          objectName: DB_USERNAME
        - key: DB_PASSWORD
          objectName: DB_PASSWORD
        - key: DB_ENDPOINT
          objectName: DB_ENDPOINT
        - key: DB_NAME
          objectName: DB_NAME
